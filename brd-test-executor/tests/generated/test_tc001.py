"""
Auto-generated test for TC001
Generated by BRD Test Executor
"""
from playwright.async_api import Page, expect
import asyncio

from playwright.sync_api import expect, TimeoutError

async def test_tc001(page: "Page"):
    try:
        # Bước 1: Truy cập trang danh sách hợp đồng CTV
        await page.goto("https://agency-uat.affina.com.vn/account/contract", wait_until="networkidle")

        # Chờ bảng danh sách hợp đồng hiển thị để đảm bảo trang đã load xong
        await page.wait_for_selector("table, .table, [role='table']", timeout=30000)

        # Bước 2: Tìm nút 'Tạo mới' sử dụng locator có sẵn
        create_button = page.locator("button:has-text('Tạo mới'), a:has-text('Tạo mới')")
        await create_button.wait_for(state="visible", timeout=30000)

        # Bước 3: Xác nhận nút hiển thị rõ ràng, không bị che khuất
        # Kiểm tra nút hiển thị (visible) và enabled (không bị disable)
        expect(create_button).to_be_visible()
        expect(create_button).to_be_enabled()

        # Kiểm tra nút không bị che khuất bằng bounding box và viewport
        box = await create_button.bounding_box()
        viewport_size = page.viewport_size
        assert box is not None, "Không lấy được bounding box của nút 'Tạo mới'"
        assert viewport_size is not None, "Không lấy được kích thước viewport"
        assert 0 <= box["x"] <= viewport_size["width"], "Nút 'Tạo mới' bị che khuất ngang"
        assert 0 <= box["y"] <= viewport_size["height"], "Nút 'Tạo mới' bị che khuất dọc"


        # Bước 4: Di chuột vào nút để kiểm tra hiệu ứng hover (nút đổi màu)
        await create_button.hover()
        # Chờ một chút để hover effect hiện ra
        await page.wait_for_timeout(500)

        hover_bg = await create_button.evaluate("(el) => window.getComputedStyle(el).backgroundColor")

        # Bước 5: Click vào nút 'Tạo mới'
        await create_button.click()

        # Chờ trang tạo mới hợp đồng load
        await page.wait_for_url("https://agency-uat.affina.com.vn/account/contract/create", timeout=30000)
        await page.wait_for_load_state("networkidle")

        # Xác nhận các trường nhập liệu hiển thị đầy đủ
        # Sử dụng các locator input có sẵn trong contract
        inputs = [
            "input[name*='employee'], input[id*='employee']",  # employee_code_input
            "input[name*='name'], input[placeholder*='Họ tên']",  # employee_name_input
            "input[name*='phone'], input[type='tel']",  # phone_input
            "input[name*='email'], input[type='email']",  # email_input
            "input[name*='start'], input[placeholder*='Ngày bắt đầu']",  # start_date
            "input[name*='end'], input[placeholder*='Ngày kết thúc']",  # end_date
            "select[name*='type'], select[id*='type']",  # contract_type
            "button:has-text('Lưu'), button[type='submit']",  # save_button
            "button:has-text('Hủy'), button:has-text('Cancel')"  # cancel_button
        ]

        for selector in inputs:
            element = page.locator(selector)
            await element.first.wait_for(state="visible", timeout=15000)
            expect(element.first).to_be_visible()

        return True

    except (AssertionError, TimeoutError, Exception) as e:
        # Chụp ảnh màn hình khi có lỗi để debug
        await page.screenshot(path="test_tc001_failure.png", full_page=True)
        print(f"Test TC001 failed: {e}")
        return False

# Run the test
if __name__ == "__main__":
    from playwright.async_api import async_playwright
    
    async def main():
        async with async_playwright() as p:
            browser = await p.chromium.launch(headless=False, channel='chrome')
            context = await browser.new_context()
            page = await context.new_page()
            
            try:
                result = await test_tc001(page)
                print(f"Test result: {'PASS' if result else 'FAIL'}")
            except Exception as e:
                print(f"Test failed with error: {e}")
            finally:
                await browser.close()
    
    asyncio.run(main())
